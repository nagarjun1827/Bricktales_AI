<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BoQ Uploads</title>
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }
    .container {
        display: flex;
        gap: 40px;
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        max-width: 1000px;
        width: 100%;
    }
    .section {
        flex: 1;
    }
    h2 {
        color: #333;
        margin-bottom: 20px;
        text-align: center;
        font-size: 24px;
    }
    .upload-area {
        border: 2px dashed #667eea;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 15px;
    }
    .upload-area:hover { border-color: #764ba2; background: #f8f9ff; }
    .upload-area.dragover { border-color: #764ba2; background: #f0f0ff; }
    .upload-icon { font-size: 40px; color: #667eea; margin-bottom: 10px; }
    .upload-text { color: #666; font-size: 14px; margin-bottom: 10px; }
    #fileInput1, #fileInput2 { display: none; }
    .file-info {
        background: #f8f9ff;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 10px;
        display: none;
    }
    .file-info.show { display: block; }
    .file-name { color: #333; font-weight: 600; margin-bottom: 5px; }
    .file-size { color: #666; font-size: 12px; }
    .btn {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .btn:hover { transform: translateY(-2px); }
    .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
    .message {
        margin-top: 10px;
        padding: 10px;
        border-radius: 8px;
        text-align: center;
        display: none;
        font-size: 14px;
    }
    .message.show { display: block; }
    .message.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 10px auto;
        display: none;
    }
    .loader.show { display: block; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body>
<div class="container">

    <!-- Google Drive Upload Section -->
    <div class="section">
        <h2>üìÅ Upload to Storage</h2>
        <div class="upload-area" id="uploadArea1">
            <div class="upload-icon">‚òÅÔ∏è</div>
            <div class="upload-text">Click or drag & drop file</div>
            <input type="file" id="fileInput1">
        </div>
        <div class="file-info" id="fileInfo1">
            <div class="file-name" id="fileName1"></div>
            <div class="file-size" id="fileSize1"></div>
        </div>
        <button class="btn" id="uploadBtn1" disabled>Upload to Storage</button>
        <div class="loader" id="loader1"></div>
        <div class="message" id="message1"></div>
    </div>

    <!-- Prediction Upload Section -->
    <div class="section">
        <h2>ü§ñ Upload for Prediction</h2>
        <div class="upload-area" id="uploadArea2">
            <div class="upload-icon">üß™</div>
            <div class="upload-text">Click or drag & drop file</div>
            <input type="file" id="fileInput2">
        </div>
        <div class="file-info" id="fileInfo2">
            <div class="file-name" id="fileName2"></div>
            <div class="file-size" id="fileSize2"></div>
        </div>
        <button class="btn" id="uploadBtn2" disabled>Predict</button>
        <div class="loader" id="loader2"></div>
        <div class="message" id="message2"></div>
    </div>

</div>

<script>
function initUpload(uploadAreaId, fileInputId, fileInfoId, fileNameId, fileSizeId, uploadBtnId, loaderId, messageId, endpoint, successText) {
    const uploadArea = document.getElementById(uploadAreaId);
    const fileInput = document.getElementById(fileInputId);
    const fileInfo = document.getElementById(fileInfoId);
    const fileName = document.getElementById(fileNameId);
    const fileSize = document.getElementById(fileSizeId);
    const uploadBtn = document.getElementById(uploadBtnId);
    const loader = document.getElementById(loaderId);
    const message = document.getElementById(messageId);

    let selectedFile = null;

    uploadArea.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
    uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
    uploadArea.addEventListener('drop', (e) => { e.preventDefault(); uploadArea.classList.remove('dragover'); handleFile(e.dataTransfer.files[0]); });

    function handleFile(file) {
        if (!file) return;
        selectedFile = file;
        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);
        fileInfo.classList.add('show');
        uploadBtn.disabled = false;
        message.classList.remove('show');
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024, sizes = ['Bytes','KB','MB','GB'];
        const i = Math.floor(Math.log(bytes)/Math.log(k));
        return Math.round(bytes / Math.pow(k,i)*100)/100 + ' ' + sizes[i];
    }

    uploadBtn.addEventListener('click', async () => {
        if (!selectedFile) return;
        const formData = new FormData();
        formData.append('data', selectedFile);
        uploadBtn.disabled = true;
        loader.classList.add('show');
        message.classList.remove('show');

        try {
            const response = await fetch(endpoint, { method:'POST', body: formData });
            const result = await response.json();
            if(response.ok && result.success) showMessage(successText + ': ' + result.fileName, 'success');
            else showMessage('‚ùå Failed. Try again.', 'error');
        } catch (err) {
            showMessage('‚ùå Error: ' + err.message, 'error');
        } finally {
            loader.classList.remove('show');
            selectedFile = null;
            fileInput.value = '';
            fileInfo.classList.remove('show');
            uploadBtn.disabled = true;
        }
    });

    function showMessage(text, type) {
        message.textContent = text;
        message.className = 'message show ' + type;
    }
}

// Initialize both sections
initUpload('uploadArea1','fileInput1','fileInfo1','fileName1','fileSize1','uploadBtn1','loader1','message1','http://localhost:5678/webhook/upload-file','‚úÖ File uploaded successfully');
initUpload('uploadArea2','fileInput2','fileInfo2','fileName2','fileSize2','uploadBtn2','loader2','message2','http://localhost:5678/webhook/predict','‚úÖ Prediction started');
</script>
<script type="module" defer>
  import Chatbot from "https://cdn.n8nchatui.com/v1/embed.js";
  Chatbot.init({
    "n8nChatUrl": "http://localhost:5678/webhook/1ab74a11-25b1-40a3-9047-d1629a105a59/chat",
    "metadata": {}, // Include any custom data to send with each message to your n8n workflow
    "theme": {
      "button": {
        "backgroundColor": "#e66ba6",
        "right": 20,
        "bottom": 20,
        "size": 50,
        "iconColor": "#000000",
        "customIconSrc": "https://www.svgrepo.com/show/339963/chat-bot.svg",
        "customIconSize": 50,
        "customIconBorderRadius": 15,
        "autoWindowOpen": {
          "autoOpen": true,
          "openDelay": 3
        },
        "borderRadius": "rounded"
      },
      "tooltip": {
        "showTooltip": true,
        "tooltipMessage": "Hello! üëã You can ask me anything about your BoQs",
        "tooltipBackgroundColor": "#bebdff",
        "tooltipTextColor": "#1c1c1c",
        "tooltipFontSize": 15
      },
      "chatWindow": {
        "borderRadiusStyle": "rounded",
        "avatarBorderRadius": 19,
        "messageBorderRadius": 10,
        "showTitle": true,
        "title": "BoQ Cost Estimator Bot",
        "titleAvatarSrc": "https://www.svgrepo.com/show/339963/chat-bot.svg",
        "avatarSize": 20,
        "welcomeMessage": "Hello! I can help you with your queries about the BoQs",
        "errorMessage": "You ran into an error.",
        "backgroundColor": "#f2f2f2",
        "height": 600,
        "width": 400,
        "fontSize": 16,
        "starterPrompts": [
          "Who are you?",
          "What do you do?"
        ],
        "starterPromptFontSize": 15,
        "renderHTML": false,
        "clearChatOnReload": false,
        "showScrollbar": false,
        "botMessage": {
          "backgroundColor": "#ad81d9",
          "textColor": "#fafafa",
          "showAvatar": true,
          "avatarSrc": "https://www.svgrepo.com/show/334455/bot.svg",
          "showCopyToClipboardIcon": false
        },
        "userMessage": {
          "backgroundColor": "#e66ba6",
          "textColor": "#ffffff",
          "showAvatar": true,
          "avatarSrc": "https://www.svgrepo.com/show/532363/user-alt-1.svg"
        },
        "textInput": {
          "placeholder": "Type your query",
          "backgroundColor": "#f5f5f5",
          "textColor": "#1e1e1f",
          "sendButtonColor": "#ad81d9",
          "maxChars": 100000,
          "maxCharsWarningMessage": "You exceeded the characters limit. Please input less than 100000 characters.",
          "autoFocus": true,
          "borderRadius": 16,
          "sendButtonBorderRadius": 50
        },
        "uploadsConfig": {
          "enabled": true,
          "acceptFileTypes": [
            "jpg",
            "pdf"
          ],
          "maxSizeInMB": 10,
          "maxFiles": 1
        },
        "voiceInputConfig": {
          "enabled": true,
          "maxRecordingTime": 10,
          "recordingNotSupportedMessage": "To record audio, use modern browsers like Chrome or Firefox that support audio recording"
        }
      }
    }
    });
  </script>
</body>
</html>
